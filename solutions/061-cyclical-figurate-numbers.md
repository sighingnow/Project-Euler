Problem 61. Cyclical figurate numbers
========================================

## 题目

Triangle, square, pentagonal, hexagonal, heptagonal, and octagonal numbers are all figurate (polygonal) numbers and are generated by the following formulae:

|:-----------:|-------------------------------|---------------------------|
| Triangle    | $P_3, n=\frac{n(n+1)}{2}$     | $1, 3, 6, 10, 15, \dots$  |
| Square      | $P_4, n=n^2$                  | $1, 4, 9, 16, 25, \dots$  |
| Pentagonal  | $P_5, n=\frac{n(3n-1)}{2}$    | $1, 5, 12, 22, 35, \dots$ |
| Hexagonal   | $P_6, n=n(2n-1)$              | $1, 6, 15, 28, 45, \dots$ |
| Heptagonal  | $P_7, n=\frac{n(5n-3)}{2}$    | $1, 7, 18, 34, 55, \dots$ |
| Octagonal   | $P_8, n=n(3n-2)$              | $1, 8, 21, 40, 65, \dots$ |

The ordered set of three 4-digit numbers: $8128, 2882, 8281$, has three interesting properties.

The set is cyclic, in that the last two digits of each number is the first two digits of the next number (including the last number with the first).
Each polygonal type: triangle $(P_{3,127}=8128)$, square $(P_{4,91}=8281)$, and pentagonal $(P_{5,44}=2882)$, is represented by a different number in the set.
This is the only set of 4-digit numbers with this property.

Find the sum of the only ordered set of six cyclic 4-digit numbers for which each polygonal type: triangle, square, pentagonal, hexagonal, heptagonal, and octagonal, is represented by a different number in the set.

[Problem 61. Cyclical figurate numbers](https://projecteuler.net/problem=61 title="Problem 61")

## 翻译

三角形数，四角形数，五角形数，六角形数，七角形数和八角形数都是定形数，他们分别由以下公式产生：

|:-----------:|-------------------------------|---------------------------|
| 三角形数     | $P_3, n=\frac{n(n+1)}{2}$     | $1, 3, 6, 10, 15, \dots$  |
| 四角形数     | $P_4, n=n^2$                  | $1, 4, 9, 16, 25, \dots$  |
| 五角形数     | $P_5, n=\frac{n(3n-1)}{2}$    | $1, 5, 12, 22, 35, \dots$ |
| 六角形数     | $P_6, n=n(2n-1)$              | $1, 6, 15, 28, 45, \dots$ |
| 七角形数     | $P_7, n=\frac{n(5n-3)}{2}$    | $1, 7, 18, 34, 55, \dots$ |
| 八角形数     | $P_8, n=n(3n-2)$              | $1, 8, 21, 40, 65, \dots$ |

三个四位数形成的有序集合: $8128, 2882, 8281$，有三个有趣的性质：

这个集合是循环的：每个数的后两位数是下一个数的前两位数，包括第三个和第一个的关系。
三种定形数中的每一种都能被这三个数中的一个不同的数代表：三角形数 $(P_{3,127}=8128)$, 四角形数 $(P_{4,91}=8281)$, 和五角形数 $(P_{5,44}=2882)$。
这是唯一具有以上性质的四位数的集合。

找出唯一的一个六个四位数的循环集合，使得从三角形数到八角形数中的每一种都能由该集合中的一个不同的数代表。求这个集合中元素之和。

[题目61：找出唯一具有循环性质的6个四位数定形数集合的元素和。](http://pe.spiritzhang.com/index.php/2011-05-11-09-44-54/62-616 title="题目61")

## 题解

答案(answer): 28684

### Python

~~~python
#! /usr/bin/env python
# -*- coding: utf-8 -*-

from time import time

def euler_61():
    fn = {
        3: lambda n: n*(n+1)//2,
        4: lambda n: n*n,
        5: lambda n: n*(3*n-1)//2,
        6: lambda n: n*(2*n-1),
        7: lambda n: n*(5*n-3)//2,
        8: lambda n: n*(3*n-2),
    }
    def init_ns(k):
        xs = {}
        for i in range(1, 140):
            m = fn[k](i)
            if m < 1000: continue
            if m > 9999: break
            u, v = m//100, m%100
            if xs.get(u) == None:
                xs[u] = [v]
            else:
                xs[u].append(v)
        return xs
    ns = dict((k, init_ns(k)) for k in range(3, 9))
    '''A more functional implementation:
    ns = dict((k, list(filter(
        lambda v: v>=1000 and v <= 9999,
        map(fn[k], range(1, 140))
    ))) for k in range(3, 9))
    '''

    summary = lambda xs: sum(xs[i]*100+xs[i+1] for i in range(len(xs)-1))
    def dfs(k, u, ks, acc):
        print(k, u, ks, acc)
        if len(acc) == 6:
            for v in ns[k][u]:
                if v == acc[0]:
                    return summary(acc+[v])
            return -1
        for nextk in range(3, 9):
            if nextk in ks:
                continue
            for v in ns[k][u]:
                if ns[nextk].get(v) == None:
                    continue
                s = dfs(nextk, v, ks+[nextk], acc+[v])
                if s != -1:
                    return s
        return -1
    ans = -1
    for u in ns[3].keys():
        ans = dfs(3, u, [3], [u])
        if ans != -1:
            break
    return ans

if __name__ == '__main__':
    t = time()
    print(euler_61(), 'time: %f s'%(time()-t))

# vim: set sw=4, ts=4
~~~
